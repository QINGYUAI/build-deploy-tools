"use strict";(self["webpackChunkmeetingvue3"]=self["webpackChunkmeetingvue3"]||[]).push([[3578],{3578:function(e,t,a){a.r(t),a.d(t,{default:function(){return S}});a(33110),a(64979);var n=a(20641),l=a(90033),i=a(50953),s=a(71029),r=a(95531),u=a(40787),o=a(41404),d=a(42861),c=a(46774),v=a(57297),g=a(67816),p=a(6164),m=a(30894);const y={class:"min-h-fit bg-gray-50 relative"},k={class:"sticky top-0 left-0 right-0 z-50 bg-white shadow"},f={class:"max-w-7xl mx-auto px-4"},h={class:"pt-8 pb-8 max-w-7xl mx-auto px-4"},b={class:"sticky bottom-0 left-0 right-0 bg-white border-t"},R={class:"max-w-7xl mx-auto px-4 py-4 flex justify-between"},L={class:"space-x-2"};var w={__name:"index",setup(e){const t=(0,i.KR)(),a=((0,i.KR)([]),async()=>{t.value<7&&(3===t.value?I():5===t.value?S():t.value++)}),w=(0,i.KR)(null),C=(0,i.KR)(null),I=async()=>{try{if(!w.value)return void r.nk.warning("请选择模板");if(!w.value)return void r.nk.warning("请选择模板");{const e={type_vue:1,siteConfigId:w.value.siteData.pccn.siteConfigId,siteTemplateId:w.value.template.id,id:w.value.siteData.pccn.id,meetingId:A.query.meeting,data:btoa(encodeURIComponent(JSON.stringify(w.value.siteData.pccn.data))),domain:null,expertSetting:null,kind:null,lang:"pccn",path:null,enable:0,only:0,paymentSetting:null,scheduleSetting:null,templateSetting:null};q.$Loadimg.showLoading();const a=await q.$http.article.updateSite(e);if(q.$Loadimg.hideLoading(),1!==a.data.status)return void r.nk.error(a.data.msg);t.value++}}catch(e){return console.error("保存模板配置失败:",e),void r.nk.error("保存模板配置失败")}},S=async()=>{try{if(!C.value)return void r.nk.warning("请选择模板");if(!C.value)return void r.nk.warning("请选择模板");{const e={type_vue:1,siteConfigId:C.value.siteData.mcn.siteConfigId,siteTemplateId:C.value.template.id,id:C.value.siteData.mcn.id,meetingId:A.query.meeting,data:btoa(encodeURIComponent(JSON.stringify(C.value.siteData.mcn.data))),domain:null,expertSetting:null,kind:null,lang:"mcn",path:null,enable:0,only:0,paymentSetting:null,scheduleSetting:null,templateSetting:null,showSecond:3,adveSecond:3,adveStatus:0,adveImg:null,agreement_content:null,agreement_status:0};q.$Loadimg.showLoading();const a=await q.$http.article.updateSite(e);if(q.$Loadimg.hideLoading(),1!==a.data.status)return void r.nk.error(a.data.msg);t.value++}}catch(e){return console.error("保存模板配置失败:",e),void r.nk.error("保存模板配置失败")}},_=()=>{t.value>1&&t.value--},x=(0,i.KR)(!1),K=((0,i.KR)("https://conference.example.com/register/123456"),(0,i.KR)("https://conference.example.com/m/register/123456"),(0,i.KR)(null),(0,i.KR)(!1)),$=(0,i.KR)(null),W=(0,i.KR)(null),F=(0,i.KR)(null),D=(0,i.KR)(null),T=(0,i.KR)(null),X=(0,i.KR)(null),Q=(0,i.KR)(null),{proxy:q}=(0,n.nI)(),A=(0,s.lq)(),N=(0,i.KR)({baseurl:"",meetingId:"",siteId:{pccn:"",mcn:"",pcen:"",men:""}}),U=(0,i.KR)(null),J=(0,i.KR)(null),O=(0,i.KR)(1),P=(0,i.KR)(""),M=(0,i.KR)(""),B=async()=>{try{K.value=!0,q.$Loadimg.showLoading();const[e,t]=await Promise.all([j(),z()]);q.$Loadimg.hideLoading(),e&&t?K.value=!1:r.nk.error("数据获取失败，请重试")}catch(e){q.$Loadimg.hideLoading(),K.value=!1,r.nk.error("数据获取失败，请重试")}},j=async()=>{try{const e={type_vue:1,meetingId:A.query.meeting},t=await q.$http.article.getSiteconfig(e);return 1===t.data.status?(N.value={baseurl:t.data.list.baseurl,meetingId:t.data.list.meetingId,siteId:t.data.list.siteId},!0):(r.nk.error(t.data.msg),!1)}catch(e){return r.nk.error("获取网站配置数据失败"),!1}},z=async()=>{try{const e={meetingId:A.query.meeting},t=await q.$http.article.FastMeetinggetSiteInfo(e);if(1===t.data.status){U.value={...t.data.list.data.mcn,data:btoa(encodeURIComponent(JSON.stringify(t.data.list.data.mcn.data)))},J.value={...t.data.list.data.pccn,data:btoa(encodeURIComponent(JSON.stringify(t.data.list.data.pccn.data)))};const e=t.data.list.data.enable;return x.value=1===e,O.value=t.data.list.data.openWebsite,P.value=t.data.list.data.apply_status,M.value=t.data.list.data.apply_remark,!0}return r.nk.error(t.data.msg),!1}catch(e){return r.nk.error(e),!1}},E=async()=>{try{const e={meetingId:A.query.meeting};q.$Loadimg.showLoading();const a=await q.$http.article.FastMeetinggetRecordStep(e);if(q.$Loadimg.hideLoading(),1===a.data.status){const e=parseInt(a.data.list);!isNaN(e)&&e>=1&&e<=7?t.value=e:t.value=1}else r.nk.error(a.data.msg),t.value=1}catch(e){console.error("获取当前步骤失败:",e),r.nk.error("获取当前步骤失败"),t.value=1}};(0,n.wB)(t,e=>{console.log("当前步骤:",e),(0,n.dY)(()=>{const t={1:$,2:W,3:F,4:D,5:T,6:X,7:Q},a=t[e];a&&a.value&&7===e&&B()})}),(0,n.sV)(()=>{E()});const V=async()=>{try{const e={meetingId:A.query.meeting,enable:x.value?0:1,mcn:JSON.stringify(U.value),pccn:JSON.stringify(J.value)};q.$Loadimg.showLoading();const t=await q.$http.article.FastMeetingreleaseSite(e);q.$Loadimg.hideLoading(),1===t.data.status?(x.value=!x.value,r.nk.success(t.data.msg),x.value&&H()):r.nk.error(t.data.msg)}catch(e){q.$Loadimg.hideLoading(),r.nk.error("操作失败")}},Y=async e=>{e!==x.value&&V()},G=async()=>{try{await z()}catch(e){console.error("刷新站点信息失败:",e)}},H=async()=>{try{const e={meetingId:A.query.meeting,step:t.value};q.$Loadimg.showLoading();await q.$http.article.FastMeetingsetRecordStep(e);q.$Loadimg.hideLoading()}catch(e){r.nk.error("保存失败")}},Z=async e=>{if(e!==t.value)try{await H(),e>t.value?u.s.confirm("跳转到后面的步骤可能会丢失未保存的数据，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{t.value=e}).catch(()=>{}):t.value=e}catch(a){r.nk.error("操作失败，请重试")}};return(e,i)=>{const s=(0,n.g2)("el-step"),r=(0,n.g2)("el-steps"),u=(0,n.g2)("el-button");return(0,n.uX)(),(0,n.CE)("div",y,[(0,n.Lk)("div",k,[(0,n.Lk)("div",f,[(0,n.bF)(r,{active:t.value-1,"finish-status":"success",class:"py-4"},{default:(0,n.k6)(()=>[(0,n.bF)(s,{title:"会议注册类别与收费",onClick:i[0]||(i[0]=e=>Z(1)),class:"cursor-pointer"}),(0,n.bF)(s,{title:"报名信息数据收集",onClick:i[1]||(i[1]=e=>Z(2)),class:"cursor-pointer"}),(0,n.bF)(s,{title:"PC端模板选择",onClick:i[2]||(i[2]=e=>Z(3)),class:"cursor-pointer"}),(0,n.bF)(s,{title:"PC端内容配置",onClick:i[3]||(i[3]=e=>Z(4)),class:"cursor-pointer"}),(0,n.bF)(s,{title:"移动端模板选择",onClick:i[4]||(i[4]=e=>Z(5)),class:"cursor-pointer"}),(0,n.bF)(s,{title:"移动端内容配置",onClick:i[5]||(i[5]=e=>Z(6)),class:"cursor-pointer"}),(0,n.bF)(s,{title:"发布",onClick:i[6]||(i[6]=e=>Z(7)),class:"cursor-pointer"})]),_:1},8,["active"])])]),(0,n.Lk)("div",h,[1===t.value?((0,n.uX)(),(0,n.Wv)(o.A,{key:0,ref_key:"registrationCategoryRef",ref:$},null,512)):(0,n.Q3)("",!0),2===t.value?((0,n.uX)(),(0,n.Wv)(d.A,{key:1,ref_key:"registrationFieldsRef",ref:W},null,512)):(0,n.Q3)("",!0),3===t.value?((0,n.uX)(),(0,n.Wv)(c.A,{key:2,ref_key:"pcTemplateSelectionRef",ref:F,selectedTemplateData:w.value,"onUpdate:selectedTemplateData":i[7]||(i[7]=e=>w.value=e)},null,8,["selectedTemplateData"])):(0,n.Q3)("",!0),4===t.value?((0,n.uX)(),(0,n.Wv)(v.A,{key:3,ref_key:"pcContentConfigurationRef",ref:D},null,512)):(0,n.Q3)("",!0),5===t.value?((0,n.uX)(),(0,n.Wv)(g.A,{key:4,ref_key:"mobileTemplateSelectionRef",ref:T,selectedTemplateData:C.value,"onUpdate:selectedTemplateData":i[8]||(i[8]=e=>C.value=e)},null,8,["selectedTemplateData"])):(0,n.Q3)("",!0),6===t.value?((0,n.uX)(),(0,n.Wv)(p.A,{key:5,ref_key:"mobileContentConfigurationRef",ref:X},null,512)):(0,n.Q3)("",!0),7===t.value?((0,n.uX)(),(0,n.Wv)(m.A,{key:6,isPublished:x.value,"site-config-data":N.value,"is-loading":K.value,"open-website":O.value,"apply-status":P.value,"apply-remark":M.value,"onUpdate:isPublished":Y,onRefreshSiteInfo:G,ref_key:"publishConfigurationRef",ref:Q},null,8,["isPublished","site-config-data","is-loading","open-website","apply-status","apply-remark"])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",b,[(0,n.Lk)("div",R,[(0,n.Lk)("div",null,[t.value>1?((0,n.uX)(),(0,n.Wv)(u,{key:0,onClick:_,class:"!rounded-button"},{default:(0,n.k6)(()=>[...i[9]||(i[9]=[(0,n.eW)("上一步",-1)])]),_:1})):(0,n.Q3)("",!0)]),(0,n.Lk)("div",L,[t.value<7?((0,n.uX)(),(0,n.Wv)(u,{key:0,onClick:H,class:"!rounded-button"},{default:(0,n.k6)(()=>[...i[10]||(i[10]=[(0,n.eW)("保存",-1)])]),_:1})):(0,n.Q3)("",!0),t.value<7?((0,n.uX)(),(0,n.Wv)(u,{key:1,type:"primary",onClick:a,class:"!rounded-button"},{default:(0,n.k6)(()=>[...i[11]||(i[11]=[(0,n.eW)("下一步",-1)])]),_:1})):(0,n.Q3)("",!0),7===t.value?((0,n.uX)(),(0,n.Wv)(u,{key:2,type:"primary",onClick:V,class:"!rounded-button",disabled:0===O.value},{default:(0,n.k6)(()=>[(0,n.eW)((0,l.v_)(x.value?"取消发布":"发布"),1)]),_:1},8,["disabled"])):(0,n.Q3)("",!0)])])])])}}},C=a(66262);const I=(0,C.A)(w,[["__scopeId","data-v-5e17831b"]]);var S=I}}]);