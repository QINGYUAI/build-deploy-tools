"use strict";(self["webpackChunkmeetingvue3"]=self["webpackChunkmeetingvue3"]||[]).push([[8133],{60894:function(e,a,t){t.d(a,{A:function(){return n}});var l=t(50953);function n(e){const a=(0,l.Kh)([{value:5,label:"数电增值税普通发票",num:6},{value:6,label:"数电增值税专用发票",num:6}]),t=(0,l.Kh)([{value:"0%",label:"0%",flag:!1},{value:"1%",label:"1%",flag:!1},{value:"2%",label:"2%",flag:!1},{value:"3%",label:"3%",flag:!1},{value:"4%",label:"4%",flag:!1},{value:"5%",label:"5%",flag:!1},{value:"6%",label:"6%",flag:!1},{value:"7%",label:"7%",flag:!1},{value:"8%",label:"8%",flag:!1},{value:"9%",label:"9%",flag:!1},{value:"10%",label:"10%",flag:!1},{value:"11%",label:"11%",flag:!1},{value:"12%",label:"12%",flag:!1},{value:"13%",label:"13%",flag:!1}]);function n(e,a){a.invoiceNo=e.kpCode}async function o(a,t){let l=[{}];const n={type_vue:1,name:a};e.$http.article.InvoiceAdmin_getDuty(n).then(e=>{1===e.data.status?(l=e.data.list,t(l)):(l=[],t(l))})}return{invoiceListType:a,TaxrateList:t,querySearchAsync:o,handleSelectMsg:n}}},78365:function(e,a,t){t.d(a,{A:function(){return u}});var l=t(20641),n=t(50953);const o={class:"paginated"};var i={__name:"index",props:["modelValue"],emits:["update:modelValue"],setup(e,{emit:a}){const t=e,i=a,s=(0,n.Kh)({page:1,per_page:10,total:0});(0,l.wB)(()=>t.modelValue,e=>{t.modelValue&&(s.page=e.page,s.per_page=e.per_page,s.total=e.total)});const{page:u,per_page:r,total:c}=(0,n.QW)(s),d=e=>{s.per_page=e},g=e=>{s.page=e};return(0,l.wB)(()=>s,e=>{i("update:modelValue",{...e})},{deep:!0}),(e,a)=>{const t=(0,l.g2)("el-pagination");return(0,l.uX)(),(0,l.CE)("div",o,[(0,l.bF)(t,(0,l.v6)({"current-page":(0,n.R1)(u),"onUpdate:currentPage":a[0]||(a[0]=e=>(0,n.i9)(u)?u.value=e:null),"page-size":(0,n.R1)(r),"onUpdate:pageSize":a[1]||(a[1]=e=>(0,n.i9)(r)?r.value=e:null),"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:(0,n.R1)(c),size:"small",onSizeChange:d,onCurrentChange:g},e.$attrs),null,16,["current-page","page-size","total"])])}}};const s=i;var u=s},98133:function(e,a,t){t.r(a),t.d(a,{default:function(){return b}});t(44114),t(18111),t(61701),t(18237);var l=t(20641),n=t(50953),o=t(90033),i=t(78365),s=t(71029),u=t(40834),r=t(60894);const c={class:"InvoiceDraft"},d={class:"box"},g={style:{width:"100%",display:"flex","justify-content":"center"}};var p={__name:"index",setup(e){const{invoiceListType:a}=(0,r.A)(),t=(0,u.Pj)(),[p,m]=[(0,s.lq)(),(0,s.rd)()],{proxy:v}=(0,l.nI)(),b=(0,n.Kh)({tableData:[],paginateData:{total:0,page:1,per_page:10},multipleTable:[],loading:!1}),{tableData:y,paginateData:f,loading:_}=(0,n.QW)(b);function k(e){b.multipleTable=e}function h(e){v.$confirm("此操作将永久删除该草稿, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(a=>{const l={did:e.id,committeeId:t.state.user.committeeId,type_vue:1};v.$Loadimg.showLoading(),v.$http.article.CommitteeInvoiceDel(l).then(e=>{v.$Loadimg.hideLoading(),1===e.data.status||200==e.data.status?(v.$message({type:"success",message:e.data.msg}),T()):v.$message({type:"error",message:e.data.msg})}).catch(e=>{console.error(e)})}).catch(e=>{v.$message({type:"warning",message:"取消操作"})})}function w(){0!==b.multipleTable.length?v.$confirm("此操作将永久删除该草稿, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(e=>{const a={did:b.multipleTable.map(e=>e.id)?.join(",")||"",committeeId:t.state.user.committeeId,type_vue:1};v.$Loadimg.showLoading(),v.$http.article.CommitteeInvoiceDel(a).then(e=>{v.$Loadimg.hideLoading(),1===e.data.status||200==e.data.status?(v.$message({type:"success",message:e.data.msg}),T()):v.$message({type:"error",message:e.data.msg})}).catch(e=>{console.error(e)})}).catch(e=>{v.$message({type:"warning",message:"取消操作"})}):v.$message({type:"warning",message:"请选择要删除的草稿"})}function x(e){m.push({path:"/IssueInvoice",query:{...p.query,type:e.invoiceType,id:e.id}})}async function T(){const e={type_vue:1,committeeId:t.state.user.committeeId,invoiceType:"",kptype:"",fphm:"",date:[],statusType:2,page:b.paginateData.page,per_page:b.paginateData.per_page,startDate:"",endDate:""};b.loading=!0,v.$http.article.CommitteeInvoiceAdminAjaxIndex(e).then(async e=>{if(b.loading=!1,1===e.data.status||200===e.data.status){b.tableData=e.data.list.map(e=>(e.loading=!0,e)),b.paginateData={...e.data.pageinfo,page:e.data.pageinfo.page,per_page:e.data.pageinfo.per_page},b.multipleTable=[],v.$message({type:"success",message:"获取成功"});for(let e of b.tableData)await $(e)}else v.$message({type:"error",message:"获取失败"})}).catch(e=>{console.error(e)})}async function $(e){const a={id:e.id,type_vue:1,committeeId:t.state.user.committeeId},l=await v.$http.article.CommitteeInvoiceDetail(a);if(1===l.data.status||200===l.data.status)try{const{invoiceData:a,invoiceDetail:t}=l.data.list;e.taxAmount=t?.reduce((e,a)=>{const t=a.taxrate.slice(0,a.taxrate.length-1)/100,l=Number(v.$calc(" a * b / c / (1 + b) * c * c",{a:a.dj,b:t,c:a.number})).toFixed(2);return e+=Number(l),e},0),e.taxAmount=Number(e.taxAmount).toFixed(2),e.amount=t?.reduce((e,a)=>{const t=a.taxrate.slice(0,a.taxrate.length-1)/100,l=Number(v.$calc(" a / (1 + b) ",{a:a.dj,b:t})).toFixed(2);return e+Number(l)*Number(a.number)},0),console.log(e.amount,"item.amount"),e.total=Number(v.$calc("a + b",{a:e.amount,b:e.taxAmount})).toFixed(2)}catch(n){console.error(n)}else console.log(l.data.msg);e.loading=!1}return(0,l.wB)(()=>t.state.user.committeeId,e=>{e&&T()},{immediate:!0}),(e,a)=>{const s=(0,l.g2)("el-button"),u=(0,l.g2)("el-table-column"),r=(0,l.g2)("el-text"),p=(0,l.g2)("el-table");return(0,l.uX)(),(0,l.CE)("div",c,[(0,l.Lk)("div",d,[(0,l.Lk)("section",null,[(0,l.bF)(s,{type:"danger",size:"small",onClick:w,loading:(0,n.R1)(_)},{default:(0,l.k6)(()=>[...a[1]||(a[1]=[(0,l.eW)("批量删除 ",-1)])]),_:1},8,["loading"]),(0,l.bF)(p,{data:(0,n.R1)(y),onSelectionChange:k,loading:(0,n.R1)(_)},{default:(0,l.k6)(()=>[(0,l.bF)(u,{type:"selection"}),(0,l.bF)(u,{label:"序号"},{default:(0,l.k6)(e=>[(0,l.eW)((0,o.v_)(e.$index+1),1)]),_:1}),(0,l.bF)(u,{label:"草稿日期"},{default:(0,l.k6)(a=>[(0,l.eW)((0,o.v_)(a.row.invoiceDate?e.$dayjs(a.row.invoiceDate).format("YYYY-MM-DD HH:mm:ss"):""),1)]),_:1}),(0,l.bF)(u,{label:"发票票种"},{default:(0,l.k6)(e=>[(0,l.Lk)("div",g,[e.row.invoiceType?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"invoice-type",style:(0,o.Tr)({background:(0,n.R1)(t).state.invoiceType[(0,n.R1)(t).state.invoiceTypeArr[e.row.invoiceType]].back,color:(0,n.R1)(t).state.invoiceType[(0,n.R1)(t).state.invoiceTypeArr[e.row.invoiceType]].color})},(0,o.v_)((0,n.R1)(t).state.invoiceType[(0,n.R1)(t).state.invoiceTypeArr[e.row.invoiceType]].text),5)):(0,l.Q3)("",!0)])]),_:1}),(0,l.bF)(u,{label:"购买方名称"},{default:(0,l.k6)(e=>[(0,l.eW)((0,o.v_)(e.row.buyername),1)]),_:1}),(0,l.bF)(u,{label:"合计金额"},{default:(0,l.k6)(e=>[e.row.amount?((0,l.uX)(),(0,l.Wv)(r,{key:0,type:e.row.amount<0?"danger":""},{default:(0,l.k6)(()=>[(0,l.eW)("￥"+(0,o.v_)(e.row.amount),1)]),_:2},1032,["type"])):((0,l.uX)(),(0,l.Wv)(r,{key:1},{default:(0,l.k6)(()=>[...a[2]||(a[2]=[(0,l.eW)("-",-1)])]),_:1}))]),_:1}),(0,l.bF)(u,{label:"合计税额"},{default:(0,l.k6)(e=>[e.row.taxAmount?((0,l.uX)(),(0,l.Wv)(r,{key:0},{default:(0,l.k6)(()=>[(0,l.eW)("￥"+(0,o.v_)(e.row.taxAmount),1)]),_:2},1024)):((0,l.uX)(),(0,l.Wv)(r,{key:1},{default:(0,l.k6)(()=>[...a[3]||(a[3]=[(0,l.eW)("-",-1)])]),_:1}))]),_:1}),(0,l.bF)(u,{label:"价税合计"},{default:(0,l.k6)(e=>[e.row.total?((0,l.uX)(),(0,l.Wv)(r,{key:0,type:e.row.total<0?"danger":""},{default:(0,l.k6)(()=>[(0,l.eW)("￥"+(0,o.v_)(e.row.total),1)]),_:2},1032,["type"])):((0,l.uX)(),(0,l.Wv)(r,{key:1},{default:(0,l.k6)(()=>[...a[4]||(a[4]=[(0,l.eW)("-",-1)])]),_:1}))]),_:1}),(0,l.bF)(u,{label:"操作"},{default:(0,l.k6)(e=>[(0,l.bF)(s,{type:"danger",size:"small",onClick:a=>h(e.row),loading:e.row.loading},{default:(0,l.k6)(()=>[...a[5]||(a[5]=[(0,l.eW)("删除 ",-1)])]),_:1},8,["onClick","loading"]),(0,l.bF)(s,{type:"primary",size:"small",onClick:a=>x(e.row),loading:e.row.loading},{default:(0,l.k6)(()=>[...a[6]||(a[6]=[(0,l.eW)("选择 ",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data","loading"])]),(0,l.bF)(i.A,{modelValue:(0,n.R1)(f),"onUpdate:modelValue":a[0]||(a[0]=e=>(0,n.i9)(f)?f.value=e:null),layout:"prev, pager, next, sizes, total","page-sizes":[10,20,30,50]},null,8,["modelValue"])])])}}},m=t(66262);const v=(0,m.A)(p,[["__scopeId","data-v-2c660212"]]);var b=v}}]);