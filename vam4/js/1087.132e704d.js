"use strict";(self["webpackChunkmeetingvue3"]=self["webpackChunkmeetingvue3"]||[]).push([[1087],{11087:function(e,t,a){a.r(t),a.d(t,{default:function(){return C}});a(44114),a(18111),a(22489),a(20116),a(7588),a(61701),a(13579),a(69112);var l=a(20641),s=a(50953),r=a(90033),p=a(73877),i=a(73151),u=a(18965),o=a(40834),n=a(71029),d=a(78365),c=a(97149);const m={class:"SupplierDatabase MinHeight"},g={class:"box"},f={style:{display:"flex","justify-content":"space-between"}},v={style:{display:"flex","justify-content":"center"}};var h={__name:"SupplierDatabase",setup(e){const t=(0,n.lq)(),a=(0,n.rd)(),{proxy:h}=(0,l.nI)(),y=(0,o.Pj)(),{ServiceItems:b,departmentList:C,showClass:I}=(0,i.A)({type:"supplier",$vm:h,route:t,store:y}),S=(0,s.KR)([{type:"select",class:"col-content",field:"F7arm59cncddakc",title:"自定义字段",info:"",effect:{fetch:""},$required:!1,options:[],_fc_id:"id_Fhmum59cncddalc",name:"ref_F6dum59cncddamc",display:!0,hidden:!1,_fc_drag_tag:"select",on:{change:R},style:{width:"200px",maxWidth:"200px"}}]),_=(0,s.Kh)({SearchOpts:{form:{inline:!1,hideRequiredAsterisk:!1,labelPosition:"right",size:"small",labelWidth:"fit-content",inlineMessage:!0},resetBtn:{show:!1,innerText:"重置"},submitBtn:{show:!1,innerText:"提交"},beforeFetch:()=>{},onSubmit:()=>{},formName:""},SearchRule:S.value,searchData:{SupplierName:"",SupplierStatus:"",supplierLang:""},customRules:[],fApi:{}}),{SearchOpts:k,SearchRule:F,searchData:x,customRules:V,fApi:A}=(0,s.QW)(_);function L(){const e={type_vue:1,committeeId:y.state.user.committeeId};h.$http.supplier.SupplierSupplierField(e).then(e=>{if(1===e.data.status||200===e.data.status){const{options:t,json:a,fields:l}=e.data.list;V.value=u.A.parseJson(a),S.value[0].options=l.map(e=>({label:e.title,value:e.field})),_.SearchRule=S.value}else h.$message.error(e.data.msg)})}function O(){x.value={SupplierName:"",SupplierStatus:"",supplierLang:""},A.value.resetFields(),S.value.length>1&&S.value.splice(1,1),N()}function w(){a.push({path:"/SupplierAdd"})}function R(e){const t=(t,a)=>{let l=null;const s=t=>{let a=null;for(let l=0;l<t.length;l++){const r=t[l];r.field===e&&(a=r),r.rule&&r.rule.length>0&&s(r.rule),r.nested&&r.nested.length>0&&s(r.nested),r.steps&&r.steps.length>0&&s(r.steps),r.children&&r.children.length>0?s(r.children):r.props&&r.props.rule&&r.props.rule.length>0?s(r.props.rule):r.props&&r.props.columns&&r.props.columns.length>0&&s(r.props.columns)}return a};return l=s(t),[l]},a=t(V.value),l={type:"col",class:"col-content",props:{},children:a,_fc_id:"id_Fl0um59e6ve0bnc",name:"ref_F4yqm59e6ve0boc",display:!0,hidden:!1,_fc_drag_tag:"col",style:{}};S.value.length>1?S.value.splice(1,1,l):S.value.splice(1,0,l),_.SearchRule=S.value}const j=(0,s.Kh)({TableData:[],paginateData:{total:0,page:1,per_page:10}}),{TableData:W,paginateData:D}=(0,s.QW)(j);function N(){h.$Loadimg.showLoading();const e={type_vue:1,committeeId:y.state.user.committeeId,page:j.paginateData.page,per_page:j.paginateData.per_page,supplierLang:"",SupplierName:"",SupplierStatus:"",...x.value};h.$http.supplier.SupplierSupplierIndex(e).then(e=>{h.$Loadimg.hideLoading(),1===e.data.status||200===e.data.status?(j.TableData=e.data.list.map(e=>(e.maxIndex=5,e.loading=!0,e.supplierId&&E(e),{...e,card:[]})),j.paginateData={total:e.data.total,page:e.data.page,per_page:e.data.per_page}):h.$message.error(e.data.msg)}).catch(e=>{console.log(e,"err")}),W.value.forEach((e,t)=>{e.maxIndex=5})}async function E(e){const t={type_vue:1,committeeId:y.state.user.committeeId,supplierId:e.supplierId},a=await h.$http.supplier.SupplierSupplierCount(t);1===a.data.status||200===a.data.status?(e.loading=!1,W.value.forEach(t=>{if(t.supplierId===e.supplierId){t.loading=!1,t.card=a.data.list;let e=[];try{const a=JSON.parse(t.supplierClassId);e=Array.isArray(a)?JSON.parse(t.supplierClassId)||[]:t.supplierClassId?t.supplierClassId.split(","):[]}catch(l){e=t.supplierClassId?t.supplierClassId.split(","):[]}e=e.filter(e=>!t.card.some(t=>t.supplierClassId==e));const s=e.map(e=>{const t=I({},e);return t?{supplierClassId:t.supplierClassId||e,supplierClassName:t.supplierClassName,supplierClassStatus:t.supplierClassStatus,receipts:0,receivable:0}:{}}),r=[...t.card,...s],p=r.filter(e=>b.value.some(t=>t.supplierClassId==e.supplierClassId));t.card=p}})):h.$message.error(a.data.msg)}const z=e=>{const t=2===e.supplierStatus?"确定是否停用，停用后将不再使用此供应商":"确定是否启用";h.$ElMessageBox.confirm(t,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t={type_vue:1,committeeId:y.state.user.committeeId,...e};h.$http.supplier.SupplierSupplierSave(t).then(e=>{1===e.data.status||200===e.data.status?(h.$message.success(e.data.msg),N()):h.$message.error(e.data.msg)}).catch(e=>{console.log(e,"err")})}).catch(()=>{e.supplierStatus=1==e.supplierStatus?2:1,h.$message({type:"info",message:"取消修改"})})};function $(e){a.push({path:"/SupplierAdd",query:{supplierId:e.supplierId}})}const B=e=>{const t=C.value.find(t=>t.committeeDepartmentId==e);return t?t.title:""};return(0,l.wB)(()=>j.paginateData,async(e,t)=>{e&&0!==t.total&&(t&&t.page===e.page&&t.per_page===e.per_page||N())},{deep:!0}),(0,l.wB)(()=>y.state.user.committeeId,e=>{e&&(N(),L())},{immediate:!0}),(e,t)=>{const a=(0,l.g2)("el-input"),i=(0,l.g2)("el-form-item"),u=(0,l.g2)("el-option"),o=(0,l.g2)("el-select"),n=(0,l.g2)("el-button"),h=(0,l.g2)("el-form"),y=(0,l.g2)("el-text"),b=(0,l.g2)("el-switch");return(0,l.uX)(),(0,l.CE)("div",m,[(0,l.Lk)("div",g,[(0,l.bF)(h,{model:(0,s.R1)(x),ref:"form",inline:!0,style:{"margin-right":"0"},size:"small"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",f,[(0,l.bF)(i,{size:"small"},{default:(0,l.k6)(()=>[(0,l.bF)(i,{class:"form-item",label:"供应商名称：",prop:"SupplierName"},{default:(0,l.k6)(()=>[(0,l.bF)(a,{style:{"min-height":"24px"},placeholder:"请输入供应商名称",modelValue:(0,s.R1)(x).SupplierName,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,s.R1)(x).SupplierName=e)},null,8,["modelValue"])]),_:1}),(0,l.bF)(i,{class:"form-item",label:"供应商状态：",prop:"SupplierStatus"},{default:(0,l.k6)(()=>[(0,l.bF)(o,{style:{width:"120px"},modelValue:(0,s.R1)(x).SupplierStatus,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,s.R1)(x).SupplierStatus=e)},{default:(0,l.k6)(()=>[(0,l.bF)(u,{label:"全部",value:""}),(0,l.bF)(u,{label:"启用",value:"1"}),(0,l.bF)(u,{label:"停用",value:"2"})]),_:1},8,["modelValue"])]),_:1}),(0,l.bF)(i,{class:"form-item",label:"来源：",prop:"supplierLang"},{default:(0,l.k6)(()=>[(0,l.bF)(o,{filterable:"",style:{width:"120px"},modelValue:(0,s.R1)(x).supplierLang,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,s.R1)(x).supplierLang=e)},{default:(0,l.k6)(()=>[(0,l.bF)(u,{label:"全部",value:""}),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)((0,s.R1)(C),e=>((0,l.uX)(),(0,l.Wv)(u,{key:e.committeeDepartmentId,label:e.title,value:e.committeeDepartmentId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,l.bF)(c.A,{api:(0,s.R1)(A),"onUpdate:api":t[3]||(t[3]=e=>(0,s.i9)(A)?A.value=e:null),modelValue:(0,s.R1)(x),"onUpdate:modelValue":t[4]||(t[4]=e=>(0,s.i9)(x)?x.value=e:null),option:(0,s.R1)(k),rule:(0,s.R1)(F),json:!1},null,8,["api","modelValue","option","rule"])]),_:1}),(0,l.bF)(i,{style:{"margin-right":"0"}},{default:(0,l.k6)(()=>[(0,l.bF)(n,{type:"primary",onClick:N},{default:(0,l.k6)(()=>[...t[7]||(t[7]=[(0,l.eW)("搜索",-1)])]),_:1}),(0,l.bF)(n,{type:"default",onClick:O},{default:(0,l.k6)(()=>[...t[8]||(t[8]=[(0,l.eW)("重置",-1)])]),_:1}),(0,l.bF)(n,{type:"primary",onClick:t[5]||(t[5]=t=>w(e.item))},{default:(0,l.k6)(()=>[...t[9]||(t[9]=[(0,l.eW)("新增供应商",-1)])]),_:1})]),_:1})])]),_:1},8,["model"]),(0,l.Lk)("ul",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)((0,s.R1)(W),e=>((0,l.uX)(),(0,l.CE)("li",{key:e.id},[(0,l.Lk)("aside",null,[(0,l.bF)(n,{type:"primary",size:"large",link:"",onClick:t=>$(e),style:{"font-size":"16px","margin-bottom":"10px","font-weight":"bold"}},{default:(0,l.k6)(()=>[(0,l.eW)(" 公司名称："+(0,r.v_)(e.supplierName)+"（查看详情） ",1)]),_:2},1032,["onClick"]),(0,l.bF)(y,{size:"large"},{default:(0,l.k6)(()=>[(0,l.eW)("公司地址："+(0,r.v_)(e.supplierAddress),1)]),_:2},1024),(0,l.bF)(y,{size:"large"},{default:(0,l.k6)(()=>[(0,l.eW)("联系人电话："+(0,r.v_)(e.supplierPhone),1)]),_:2},1024),(0,l.bF)(y,{size:"large"},{default:(0,l.k6)(()=>[(0,l.eW)("来源："+(0,r.v_)(B(e.supplierLang)),1)]),_:2},1024),(0,l.bF)(y,{size:"large"},{default:(0,l.k6)(()=>[t[10]||(t[10]=(0,l.eW)(" 供应商状态：",-1)),e?((0,l.uX)(),(0,l.Wv)(b,{key:0,modelValue:e.supplierStatus,"onUpdate:modelValue":t=>e.supplierStatus=t,"active-text":"启用","inactive-text":"停用","active-value":1,"inactive-value":2,"inline-prompt":"",onChange:t=>z(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(0,l.Q3)("",!0)]),_:2},1024)]),(0,l.Lk)("section",null,[(0,l.bF)(p.A,{card:e.card,item:e,type:"Supplier"},null,8,["card","item"])])]))),128))]),(0,l.Lk)("div",v,[(0,l.bF)(d.A,{modelValue:(0,s.R1)(D),"onUpdate:modelValue":t[6]||(t[6]=e=>(0,s.i9)(D)?D.value=e:null),layout:"prev, pager, next, sizes, total","page-sizes":[10,20,30,50]},null,8,["modelValue"])])])])}}},y=a(66262);const b=(0,y.A)(h,[["__scopeId","data-v-67576794"]]);var C=b},73151:function(e,t,a){a(18111),a(20116),a(7588),a(61701),a(69112);var l=a(50953),s=a(20641);t.A=({type:e,$vm:t,route:a,store:r})=>{const p=(0,l.Kh)({ServiceItems:[],departmentList:[]}),{ServiceItems:i,departmentList:u}=(0,l.QW)(p),o=()=>{const e={committeeId:r.state.user.committeeId};t.$http.supplier.SupplierSupplierClassList(e).then(e=>{200!==e.data.status&&1!==e.data.status||(p.ServiceItems=e.data.list)}).catch(e=>{console.log(e,"err")})};function n(){const e={type_vue:"1",id:r.state.user.committeeSiteId};t.$http.supplier.SupplierDepartment(e).then(e=>{1===e.data.status?p.departmentList=e.data.list:t.$message.error(e.data.msg)}).catch(e=>{console.log(e,"err")})}"supplier"===e&&(0,s.wB)(()=>r.state.user,()=>{"supplier"===e&&r.state.user.committeeId&&(o(),r.state.user.committeeSiteId&&n())},{immediate:!0});const d=(e,t)=>{let a=[];if(e.supplierClassId){let t=[];try{const a=JSON.parse(e.supplierClassId);t=Array.isArray(a)?JSON.parse(e.supplierClassId)||[]:e.supplierClassId?e.supplierClassId.split(","):[]}catch(l){t=e.supplierClassId?e.supplierClassId.split(","):[]}a=t.map(e=>{const t=i.value.find(t=>t.supplierClassId==e);return{name:t?t.supplierClassName:"",id:t?t.supplierClassId:""}})}if(t){const e=i.value.find(e=>e.supplierClassId==t);return{name:e?e.supplierClassName:"",id:e?e.supplierClassId:"",...e}}return a};function c(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(t){console.error(t)}if(Array.isArray(e))e.forEach(e=>{c(e)});else{if("object"!=typeof e)return e;if("[object Object]"!==Object.prototype.toString.call(e))return[];for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=c(e[t]))}return e}function m(e){return"false"!==e&&("true"===e||e)}function g({form:e,list:t,FixedFields:a,customField:l,fieldName:s}){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&Object.keys(a).includes(r)){const a=t[r];e.value[r]=a}l&&l.length>0&&l.forEach(t=>{try{const a=JSON.parse(t.supplierVal);Array.isArray(a)?e.value[t[s]]=c(a)||[]:e.value[t[s]]="object"==typeof a?c(a)||[]:m(t.supplierVal)}catch(a){e.value[t[s]]=m(t.supplierVal)}})}return{showClass:d,ServiceItems:i,departmentList:u,SetCustomField:g}}},73877:function(e,t,a){a.d(t,{A:function(){return m}});a(44114),a(18111),a(22489);var l=a(20641),s=a(90033),r=a(50953),p=a(71029);const i={class:"cardView"},u=["onClick"],o={class:"btn"};var n={__name:"CardView",props:{card:{type:Array,required:!0,default:()=>[]},item:{type:Object,required:!0,default:()=>{}},type:{type:String,required:!0,default:()=>""}},setup(e){const t=(0,p.rd)(),a=e;function n(e){t.push({path:"/SupplierDetail",query:{supplierId:e.supplierId}})}function d(e){e.maxIndex>=e.card.length?e.maxIndex=5:e.maxIndex=e.maxIndex+5}function c(e,l){const s={classId:l.supplierClassId};"Meeting"==a.type?s.meetingId=e.id:"Supplier"==a.type&&(s.supplierId=e.supplierId),t.push({path:"/SupplierDetail",query:s})}const m=(0,r.Kh)({ColorList:[{color:"rgb(47, 84, 235)"},{color:"rgb(82, 196, 26)"},{color:"rgb(164, 30, 143)"},{color:"rgb(87, 202, 255)"},{color:"rgb(255, 77, 79)"},{color:"#0991E6"},{color:"#E276A3 "},{color:"#248067"},{color:"#2E317C"},{color:"#248067"},{color:"#FDC73F"},{color:"#E2A449"},{color:"#D85B19"},{color:"#644B43"},{color:"#CC163A"},{color:"#72265D"},{color:"#CC163A"},{color:"#E276A3"},{color:"#2E317C"},{color:"#69BA3B"},{color:"#0991E6"}]}),{ColorList:g}=(0,r.QW)(m);function f(e){return e>=g.value.length&&(e%=g.value.length),g.value[e].color}return(t,a)=>{const r=(0,l.g2)("el-tooltip"),p=(0,l.g2)("el-text"),m=(0,l.g2)("el-button"),g=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",i,[(0,l.Lk)("div",{class:(0,s.C4)(["top",e.card.length>0?"":"hide"])},[e.card.length>0?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(e.card.filter((t,a)=>a<=e.item.maxIndex-1),(t,a)=>(0,l.bo)(((0,l.uX)(),(0,l.CE)("div",{class:"card",key:t.id},[(0,l.bF)(r,{content:t.supplierClassName,placement:"top",effect:"dark"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",{onClick:a=>c(e.item,t),style:(0,s.Tr)({color:f(a),borderColor:f(a)})},[(0,l.Lk)("p",{style:(0,s.Tr)({color:f(a),borderColor:f(a)})},(0,s.v_)(t.supplierClassName),5)],12,u)]),_:2},1032,["content"])])),[[g,e.item.loading]])),128)):((0,l.uX)(),(0,l.Wv)(p,{key:1,size:"large",type:"primary"},{default:(0,l.k6)(()=>[...a[2]||(a[2]=[(0,l.eW)("暂无服务项",-1)])]),_:1}))],2),(0,l.Lk)("div",o,["Supplier"===e.type?((0,l.uX)(),(0,l.Wv)(m,{key:0,type:"primary",link:"",size:"default",onClick:a[0]||(a[0]=t=>n(e.item))},{default:(0,l.k6)(()=>[...a[3]||(a[3]=[(0,l.eW)("查看全部",-1)])]),_:1})):(0,l.Q3)("",!0),e.item.card.length>5?((0,l.uX)(),(0,l.Wv)(m,{key:1,type:"primary",link:"",size:"default",onClick:a[1]||(a[1]=t=>d(e.item))},{default:(0,l.k6)(()=>[(0,l.eW)((0,s.v_)(e.item.maxIndex>=e.card.length&&e.card.length>5?"收起":"更多"),1)]),_:1})):(0,l.Q3)("",!0)])])}}},d=a(66262);const c=(0,d.A)(n,[["__scopeId","data-v-6c96f375"]]);var m=c},78365:function(e,t,a){a.d(t,{A:function(){return u}});var l=a(20641),s=a(50953);const r={class:"paginated"};var p={__name:"index",props:["modelValue"],emits:["update:modelValue"],setup(e,{emit:t}){const a=e,p=t,i=(0,s.Kh)({page:1,per_page:10,total:0});(0,l.wB)(()=>a.modelValue,e=>{a.modelValue&&(i.page=e.page,i.per_page=e.per_page,i.total=e.total)});const{page:u,per_page:o,total:n}=(0,s.QW)(i),d=e=>{i.per_page=e},c=e=>{i.page=e};return(0,l.wB)(()=>i,e=>{p("update:modelValue",{...e})},{deep:!0}),(e,t)=>{const a=(0,l.g2)("el-pagination");return(0,l.uX)(),(0,l.CE)("div",r,[(0,l.bF)(a,(0,l.v6)({"current-page":(0,s.R1)(u),"onUpdate:currentPage":t[0]||(t[0]=e=>(0,s.i9)(u)?u.value=e:null),"page-size":(0,s.R1)(o),"onUpdate:pageSize":t[1]||(t[1]=e=>(0,s.i9)(o)?o.value=e:null),"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:(0,s.R1)(n),size:"small",onSizeChange:d,onCurrentChange:c},e.$attrs),null,16,["current-page","page-size","total"])])}}};const i=p;var u=i},97149:function(e,t,a){a.d(t,{A:function(){return u}});a(44114),a(18111),a(61701),a(33110);var l=a(20641),s=a(18965),r=a(50953),p={__name:"FormCreate",props:{modelValue:{type:Object,default:()=>{}},rule:{type:[String,Array],default:()=>[]},option:{type:[String,Object],default:()=>({})},api:{type:Object,default:()=>{}},FixedFields:{type:Object,default:()=>{}},json:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","update:api","submit"],setup(e,{emit:t}){const{proxy:a}=(0,l.nI)(),p=e,i=(0,r.KR)([]),u=(0,r.KR)({}),o=(0,r.KR)(!1);(0,l.sV)(()=>{if(p.json?(i.value=s.A.parseJson(p.rule),u.value=s.A.parseJson(p.option)):(i.value=p.rule,u.value=p.option),p.disabled){const e=s.A.parseJson(p.option);e.submitBtn.show=!1,u.value=e}(0,l.dY)(()=>{o.value=!0})});const n=t,d=(0,l.EW)({get(){return p.modelValue},set(e){n("update:modelValue",e)}}),c=(0,l.EW)({get(){return p.api},set(e){n("update:api",e)}}),m=e=>"string"===typeof e?e:e instanceof Object?JSON.stringify(e):e||null===e||void 0===e||!1===e?e:"";function g(e,t){const a=t.toJson(),l=p.FixedFields,s=[];for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r))if(Object.prototype.hasOwnProperty.call(l,r))l[r]=m(e[r]);else{const t=f(e[r]);s.push({supplierKeyId:r,supplierVal:m(t)})}n("submit",{formData:e,fixedFields:l,val:s,supplierKey:a})}function f(e){if(Array.isArray(e))return e.map(e=>f(e));if(e instanceof Object){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=m(e[t]));return e}return e||""}return(0,l.sV)(()=>{}),(t,a)=>{const s=(0,l.g2)("FormCreate",!0);return o.value?((0,l.uX)(),(0,l.Wv)(s,{key:0,rule:i.value,option:u.value,modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),api:c.value,"onUpdate:api":a[1]||(a[1]=e=>c.value=e),onSubmit:g,disabled:e.disabled},null,8,["rule","option","modelValue","api","disabled"])):(0,l.Q3)("",!0)}}};const i=p;var u=i}}]);