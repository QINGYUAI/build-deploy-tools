"use strict";(self["webpackChunkmeetingvue3"]=self["webpackChunkmeetingvue3"]||[]).push([[2734],{72734:function(e,t,l){l.r(t),l.d(t,{default:function(){return L}});l(44114),l(18111),l(61701),l(69112);var a=l(20641),s=l(90033),u=l(50953),i=l(71029);const r={class:"bindAccount"},o={class:"radio"},p={style:{width:"100%",display:"flex","justify-content":"center"}};var n={__name:"index",props:{fApi:{type:Object,default:()=>{}}},setup(e,{expose:t}){const l=e,{proxy:n}=(0,a.nI)(),d=(0,i.lq)(),c=(0,u.Kh)({bindDialog:!1,bindAccount:{phone:"",userId:""},formRef:null,AccountList:[]}),{bindDialog:m,bindAccount:f,formRef:v,AccountList:y}=(0,u.QW)(c);function b(){m.value=!0}function g(e){e.validate(e=>{if(!e)return console.log("error submit!!"),!1;if(f.value.userId)l.fApi.submit(),m.value=!1;else if(0===y.value.length){const e={phone:f.value.phone};n.$http.supplier.HomeSupplierSupplierUserPhone(e).then(e=>{1===e.data.status||200===e.data.status?(y.value=e.data.list,0===e.data.list.length?n.$message.warning("该手机号未绑定账户"):1===e.data.list.length&&(f.value.userId=e.data.list[0].id)):n.$message.error(e.data.msg)}).catch(e=>{console.error(e)})}else n.$message.warning("请选择账户")})}function h(){v.value.resetFields(),f.value={phone:"",userId:""},y.value=[]}return t({bindDialog:m,bindAccount:f,formRef:v,AccountList:y,onBindAccount:b}),(e,t)=>{const l=(0,a.g2)("el-button"),i=(0,a.g2)("el-input"),n=(0,a.g2)("el-form-item"),c=(0,a.g2)("el-text"),I=(0,a.g2)("el-radio"),k=(0,a.g2)("el-radio-group"),F=(0,a.g2)("el-form"),A=(0,a.g2)("el-dialog");return(0,a.uX)(),(0,a.CE)("div",r,["share"===(0,u.R1)(d).query.type?((0,a.uX)(),(0,a.Wv)(l,{key:0,type:"primary",size:"small",onClick:b},{default:(0,a.k6)(()=>[...t[6]||(t[6]=[(0,a.eW)("绑定账户",-1)])]),_:1})):(0,a.Q3)("",!0),(0,a.bF)(A,{modelValue:(0,u.R1)(m),"onUpdate:modelValue":t[4]||(t[4]=e=>(0,u.i9)(m)?m.value=e:null),title:"绑定账户",class:"bindDialog",width:"500",onClosed:t[5]||(t[5]=e=>h((0,u.R1)(v)))},{default:(0,a.k6)(()=>[(0,a.bF)(F,{ref_key:"formRef",ref:v,model:(0,u.R1)(f),rules:{phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1(3\d|4[5-9]|5[0-35-9]|6[2567]|7[0-8]|8\d|9[0-35-9])\d{8}$/,message:"请输入正确的手机号",trigger:"blur"}]},"label-width":"100px"},{default:(0,a.k6)(()=>[0===(0,u.R1)(y).length?((0,a.uX)(),(0,a.Wv)(n,{key:0,label:"手机号：",prop:"phone"},{default:(0,a.k6)(()=>[(0,a.bF)(i,{modelValue:(0,u.R1)(f).phone,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,u.R1)(f).phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})):((0,a.uX)(),(0,a.Wv)(n,{key:1,label:"","label-width":"0",prop:"userId"},{default:(0,a.k6)(()=>[(0,a.bF)(k,{modelValue:(0,u.R1)(f).userId,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,u.R1)(f).userId=e),size:"small"},{default:(0,a.k6)(()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)((0,u.R1)(y),e=>((0,a.uX)(),(0,a.Wv)(I,{border:"",key:e.key,value:e.id},{default:(0,a.k6)(()=>[(0,a.Lk)("div",o,[(0,a.bF)(c,null,{default:(0,a.k6)(()=>[(0,a.eW)("邮箱："+(0,s.v_)(e.account),1)]),_:2},1024),(0,a.bF)(c,null,{default:(0,a.k6)(()=>[(0,a.eW)("姓名："+(0,s.v_)(e.fullName),1)]),_:2},1024),(0,a.bF)(c,null,{default:(0,a.k6)(()=>[(0,a.eW)("账户ID："+(0,s.v_)(e.id),1)]),_:2},1024)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})),(0,a.bF)(n,{label:"","label-width":"0"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",p,[(0,a.bF)(l,{onClick:t[2]||(t[2]=e=>m.value=!1)},{default:(0,a.k6)(()=>[...t[7]||(t[7]=[(0,a.eW)("取消",-1)])]),_:1}),(0,a.bF)(l,{type:"primary",onClick:t[3]||(t[3]=e=>g((0,u.R1)(v)))},{default:(0,a.k6)(()=>[...t[8]||(t[8]=[(0,a.eW)("确定",-1)])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},d=l(66262);const c=(0,d.A)(n,[["__scopeId","data-v-cb552f0a"]]);var m=c,f=l(97149),v=l(73151),y=l(40834);const b={class:"SupplierAdd"},g={class:"box"},h={class:"platform-info"},I={class:"info-item"},k={class:"value"},F={class:"info-item"},A={class:"value"},S={class:"info-item"},_={class:"value"};var R={__name:"SupplierAdd",setup(e){const t=(0,i.rd)(),l=(0,i.lq)(),r=(0,y.Pj)(),{proxy:o}=(0,a.nI)(),{SetCustomField:p,departmentList:n}=(0,v.A)({type:"supplier",$vm:o,route:l,store:r}),d=(0,u.Kh)({rule:"[]",options:"{}",form:{},fApi:{},loading:!1,FixedFields:{supplierClassId:"",supplierName:"",supplierNum:"",supplierUsername:"",supplierEmail:"",supplierAddress:"",supplierPhone:"",supplierLang:"",supplierStatus:"",supplierType:"",supplierOpenBank:"",supplierAccount:"",supplierBankName:"",supplierImg:"",supplierUserImg:""},userId:"",BindRef:null,user:{}}),{rule:c,options:R,form:C,fApi:L,loading:O,FixedFields:V,BindRef:j,user:w}=(0,u.QW)(d);function x(){const e={type_vue:1,committeeId:r.state.user.committeeId};o.$http.supplier.SupplierSupplierField(e).then(e=>{if(1===e.data.status||200===e.data.status){const{json:t,options:l,fields:a}=e.data.list;c.value=t,R.value=l,O.value=!0}else o.$message.error(e.data.msg)}).catch(e=>{console.log(e,"err")})}function $(){const e={type_vue:1,committeeId:r.state.user.committeeId,supplierId:l.query.supplierId};o.$http.supplier.SupplierSupplierDetail(e).then(e=>{if(1===e.data.status||200===e.data.status){w.value=e.data.user;const{decodedResult:{options:t,json:l},list:a,customField:s}=e.data.list;c.value=l,R.value=t,p({form:C,list:a,FixedFields:V.value,customField:s,fieldName:"supplierKeyId"}),C.value.supplierClassId=JSON.parse(a.supplierClassId),console.log(C.value,"form.value"),O.value=!0,d.userId=a.userId}else o.$message.error(e.data.msg)}).catch(e=>{console.log(e,"err")})}function W({formData:e,fixedFields:a,val:s,supplierKey:u,api:i}){const p=j.value.bindAccount.userId||d.userId;if(!p)return void j.value.onBindAccount();o.$Loadimg.showLoading();const n={userId:p,type_vue:1,committeeId:r.state.user.committeeId,supplierId:l.query.supplierId,...a,supplierKey:u,val:s};o.$http.supplier.SupplierSupplierSave(n).then(e=>{o.$Loadimg.hideLoading(),1===e.data.status||200===e.data.status?(o.$message.success(e.data.msg),t.push({path:"/SupplierDatabase"})):o.$message.error(e.data.msg)}).catch(e=>{console.log(e,"err")})}return(0,a.wB)(()=>r.state.user.committeeId,e=>{e&&(l.query.supplierId?$():x())},{immediate:!0}),(0,a.wB)(()=>[n.value,L.value],e=>{e[0]&&e[0].length&&e[1].updateRule&&(0,a.dY)(()=>{L.value.updateRule("supplierLang",{options:n.value.map(e=>({label:e.title,value:e.committeeDepartmentId+""}))})})},{immediate:!0}),(e,t)=>((0,a.uX)(),(0,a.CE)("div",b,[(0,a.Lk)("div",g,[(0,a.Lk)("div",h,[(0,a.Lk)("div",I,[t[2]||(t[2]=(0,a.Lk)("span",{class:"label"},"平台ID:",-1)),(0,a.Lk)("span",k,(0,s.v_)((0,u.R1)(w).id||"--"),1)]),(0,a.Lk)("div",F,[t[3]||(t[3]=(0,a.Lk)("span",{class:"label"},"平台姓名:",-1)),(0,a.Lk)("span",A,(0,s.v_)((0,u.R1)(w).fullName||"--"),1)]),(0,a.Lk)("div",S,[t[4]||(t[4]=(0,a.Lk)("span",{class:"label"},"平台邮箱:",-1)),(0,a.Lk)("span",_,(0,s.v_)((0,u.R1)(w).account||"--"),1)])]),(0,a.bF)(m,{ref_key:"BindRef",ref:j,fApi:(0,u.R1)(L)},null,8,["fApi"]),(0,u.R1)(O)?((0,a.uX)(),(0,a.Wv)(f.A,{key:0,rule:(0,u.R1)(c),option:(0,u.R1)(R),modelValue:(0,u.R1)(C),"onUpdate:modelValue":t[0]||(t[0]=e=>(0,u.i9)(C)?C.value=e:null),api:(0,u.R1)(L),"onUpdate:api":t[1]||(t[1]=e=>(0,u.i9)(L)?L.value=e:null),FixedFields:(0,u.R1)(V),onSubmit:W},null,8,["rule","option","modelValue","api","FixedFields"])):(0,a.Q3)("",!0)])]))}};const C=(0,d.A)(R,[["__scopeId","data-v-31d104bf"]]);var L=C},73151:function(e,t,l){l(18111),l(20116),l(7588),l(61701),l(69112);var a=l(50953),s=l(20641);t.A=({type:e,$vm:t,route:l,store:u})=>{const i=(0,a.Kh)({ServiceItems:[],departmentList:[]}),{ServiceItems:r,departmentList:o}=(0,a.QW)(i),p=()=>{const e={committeeId:u.state.user.committeeId};t.$http.supplier.SupplierSupplierClassList(e).then(e=>{200!==e.data.status&&1!==e.data.status||(i.ServiceItems=e.data.list)}).catch(e=>{console.log(e,"err")})};function n(){const e={type_vue:"1",id:u.state.user.committeeSiteId};t.$http.supplier.SupplierDepartment(e).then(e=>{1===e.data.status?i.departmentList=e.data.list:t.$message.error(e.data.msg)}).catch(e=>{console.log(e,"err")})}"supplier"===e&&(0,s.wB)(()=>u.state.user,()=>{"supplier"===e&&u.state.user.committeeId&&(p(),u.state.user.committeeSiteId&&n())},{immediate:!0});const d=(e,t)=>{let l=[];if(e.supplierClassId){let t=[];try{const l=JSON.parse(e.supplierClassId);t=Array.isArray(l)?JSON.parse(e.supplierClassId)||[]:e.supplierClassId?e.supplierClassId.split(","):[]}catch(a){t=e.supplierClassId?e.supplierClassId.split(","):[]}l=t.map(e=>{const t=r.value.find(t=>t.supplierClassId==e);return{name:t?t.supplierClassName:"",id:t?t.supplierClassId:""}})}if(t){const e=r.value.find(e=>e.supplierClassId==t);return{name:e?e.supplierClassName:"",id:e?e.supplierClassId:"",...e}}return l};function c(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(t){console.error(t)}if(Array.isArray(e))e.forEach(e=>{c(e)});else{if("object"!=typeof e)return e;if("[object Object]"!==Object.prototype.toString.call(e))return[];for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=c(e[t]))}return e}function m(e){return"false"!==e&&("true"===e||e)}function f({form:e,list:t,FixedFields:l,customField:a,fieldName:s}){for(const u in t)if(Object.prototype.hasOwnProperty.call(t,u)&&Object.keys(l).includes(u)){const l=t[u];e.value[u]=l}a&&a.length>0&&a.forEach(t=>{try{const l=JSON.parse(t.supplierVal);Array.isArray(l)?e.value[t[s]]=c(l)||[]:e.value[t[s]]="object"==typeof l?c(l)||[]:m(t.supplierVal)}catch(l){e.value[t[s]]=m(t.supplierVal)}})}return{showClass:d,ServiceItems:r,departmentList:o,SetCustomField:f}}},97149:function(e,t,l){l.d(t,{A:function(){return o}});l(44114),l(18111),l(61701),l(33110);var a=l(20641),s=l(18965),u=l(50953),i={__name:"FormCreate",props:{modelValue:{type:Object,default:()=>{}},rule:{type:[String,Array],default:()=>[]},option:{type:[String,Object],default:()=>({})},api:{type:Object,default:()=>{}},FixedFields:{type:Object,default:()=>{}},json:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","update:api","submit"],setup(e,{emit:t}){const{proxy:l}=(0,a.nI)(),i=e,r=(0,u.KR)([]),o=(0,u.KR)({}),p=(0,u.KR)(!1);(0,a.sV)(()=>{if(i.json?(r.value=s.A.parseJson(i.rule),o.value=s.A.parseJson(i.option)):(r.value=i.rule,o.value=i.option),i.disabled){const e=s.A.parseJson(i.option);e.submitBtn.show=!1,o.value=e}(0,a.dY)(()=>{p.value=!0})});const n=t,d=(0,a.EW)({get(){return i.modelValue},set(e){n("update:modelValue",e)}}),c=(0,a.EW)({get(){return i.api},set(e){n("update:api",e)}}),m=e=>"string"===typeof e?e:e instanceof Object?JSON.stringify(e):e||null===e||void 0===e||!1===e?e:"";function f(e,t){const l=t.toJson(),a=i.FixedFields,s=[];for(const u in e)if(Object.prototype.hasOwnProperty.call(e,u))if(Object.prototype.hasOwnProperty.call(a,u))a[u]=m(e[u]);else{const t=v(e[u]);s.push({supplierKeyId:u,supplierVal:m(t)})}n("submit",{formData:e,fixedFields:a,val:s,supplierKey:l})}function v(e){if(Array.isArray(e))return e.map(e=>v(e));if(e instanceof Object){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=m(e[t]));return e}return e||""}return(0,a.sV)(()=>{}),(t,l)=>{const s=(0,a.g2)("FormCreate",!0);return p.value?((0,a.uX)(),(0,a.Wv)(s,{key:0,rule:r.value,option:o.value,modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=e=>d.value=e),api:c.value,"onUpdate:api":l[1]||(l[1]=e=>c.value=e),onSubmit:f,disabled:e.disabled},null,8,["rule","option","modelValue","api","disabled"])):(0,a.Q3)("",!0)}}};const r=i;var o=r}}]);